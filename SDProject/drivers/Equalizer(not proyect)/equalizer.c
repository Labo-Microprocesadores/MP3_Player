/*
 * equalizer.c
 *
 *  Created on: Mar 8, 2019
 *      Author: Grupo 2
 */
#include "arm_math.h"
#include "math_helper.h"
#include "equalizer.h"


/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

/* ----------------------------------------------------------------------
** Arm Biquad cascade filters for each band
** ------------------------------------------------------------------- */
static arm_biquad_cas_df1_32x64_ins_q31 S1;
static arm_biquad_cas_df1_32x64_ins_q31 S2;
static arm_biquad_casd_df1_inst_q31 S3;
static arm_biquad_casd_df1_inst_q31 S4;
static arm_biquad_casd_df1_inst_q31 S5;
static arm_biquad_casd_df1_inst_q31 S6;
static arm_biquad_casd_df1_inst_q31 S7;
static arm_biquad_casd_df1_inst_q31 S8;

/* ----------------------------------------------------------------------
** Q31 state buffers for Band1, Band2, Band3, Band4, Band5, Band6, Band7 and Band8
** ------------------------------------------------------------------- */

static q63_t biquadStateBandQ63[4 * 2][2];
static q31_t biquadStateBandQ31[4 * 2][6];



/* ----------------------------------------------------------------------
** Entire coefficient table.  There are 10 coefficients per 4th order Biquad
** cascade filter.  The first 10 coefficients correspond to the -10 dB gain
** setting of band 1; the next 10 coefficient correspond to the -9 dB gain
** setting of band 1; and so on.  There are 10*21=210 coefficients in total
** for band 1 (gains = -10,...0,...10).  After this come the 210 coefficients
** for band 2.
**
** The coefficients are in Q31 format
** ------------------------------------------------------------------- */
q31_t coeffTable[NUMBER_OF_BANDS * COEF_PER_FILTER * GAIN_LEVELS];
static const float32_t floatCoeffTable[NUMBER_OF_BANDS * COEF_PER_FILTER * GAIN_LEVELS] = {
/* 80Hz band*/
0.25000000000000000000,-0.49910364769967047000,0.24914597735689320000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49932073437590241000,0.24934557935798454000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49904620245353337000,0.24908920958439607000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49928866823854468000,0.24931311746667442000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49898459249951144000,0.24902833054875576000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49925546309308821000,0.24927949918622364000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49891847922930366000,0.24896300684115635000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49922114331429690000,0.24924474846096339000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49884749313965637000,0.24889287480806080000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49918574555828066000,0.24920890153954442000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49877123020447833000,0.24881753697642972000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49914932128855649000,0.24917200955405497000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49868924960285377000,0.24873655997556401000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49911193788113534000,0.24913413955389732000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49860106910932422000,0.24864946999905704000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49907368199844915000,0.24909537795570119000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49850616139399451000,0.24855574928527627000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49903466198051960000,0.24905583292704520000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49840395064923704000,0.24845483298434551000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49899500983231510000,0.24901563633670573000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.49817504143068198000,0.24822888685445513000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49891447961899071000,0.24893395900152449000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49804690347779745000,0.24810244847522553000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49887401571756873000,0.24889289269497281000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49790857256573795000,0.24796598709249926000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49883375559677334000,0.24885201138349575000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49775915649052693000,0.24781863264518350000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49879399977271877000,0.24881161608845831000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49759768497748202000,0.24765944052889452000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49875509181150834000,0.24877205111254436000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49742310758993280000,0.24748739018698612000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49871741835271644000,0.24873370404014916000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49723429017187343000,0.24730138225024584000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49868141047771181000,0.24869700718752932000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49703001559558813000,0.24710024016967161000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49864754064498773000,0.24866243453706491000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49680898485159597000,0.24688271224594119000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49861631914771887000,0.24863049827026507000,-0.49895488563331614000,0.24897494825763172000,
0.25000000000000000000,-0.49656982375701375000,0.24664747944825416000,-0.49829380671249335000,0.24834610343344643000,0.25000000000000000000,-0.49858828480987938000,0.24860173946906222000,-0.49895488563331614000,0.24897494825763172000,
/* 160Hz band*/
0.25000000000000000000,-0.49812585442890256000,0.24829487744499668000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49859358985673985000,0.24869283679295529000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49801003632203206000,0.24818174488230282000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49853042522317970000,0.24862808494927022000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49788584280082704000,0.24806044825060028000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49846503193657632000,0.24856103496428733000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49775259521347048000,0.24793032934930218000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49839746056714240000,0.24849173575252581000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49760955313502320000,0.24779067072860617000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49832778628865365000,0.24842026095685957000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49745590833078640000,0.24764069003418371000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49825611272133330000,0.24834671282291362000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49729077814109224000,0.24747953385096735000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49818257622499562000,0.24827122651882211000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49711319825278638000,0.24730627100316291000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49810735066977080000,0.24819397495017814000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49692211502497452000,0.24711988553007561000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49803065250924350000,0.24811517385926576000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49671637699576127000,0.24691926893103427000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49795274652116850000,0.24803508762894844000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.49625578839861195000,0.24647039806378926000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49779464733256251000,0.24787239629901001000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49599806423083836000,0.24621939149348204000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49771527981400243000,0.24779061816014650000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49571991887152772000,0.24594863276704024000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49763636831578351000,0.24770922143933333000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49541957298351630000,0.24565642923166900000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49755851080192259000,0.24762880625566344000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49509509426837439000,0.24534094914240095000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49748238850180060000,0.24755005678382636000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49474439055136055000,0.24500021719211576000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49740876875191919000,0.24747374422719259000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49436520529171685000,0.24463211286485886000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49733850518138911000,0.24740072715217454000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49395511705729794000,0.24423437319816424000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49727253369030877000,0.24733194761033181000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49351154379347006000,0.24380460076285856000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49721186337896900000,0.24726842224054754000,-0.49787395165015447000,0.24795403516678197000,
0.25000000000000000000,-0.49303175410020367000,0.24334027909375269000,-0.49649472612709034000,0.24670321231746858000,0.25000000000000000000,-0.49715756020150392000,0.24721122607140841000,-0.49787395165015447000,0.24795403516678197000,
/* 320Hz band*/
0.25000000000000000000,-0.49592774260051731000,0.24660142688971481000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49699632665687199000,0.24739222982443557000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49569254384406158000,0.24637677578549202000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49687387947482820000,0.24726340061620319000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49544042377701641000,0.24613602901573201000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49674717222107467000,0.24713003406848016000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49517002196078219000,0.24587790548036187000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49661631221339753000,0.24699223112265883000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49487985540182738000,0.24560101122856218000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49648145543606181000,0.24685014192556773000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49456830673350805000,0.24530382912387497000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49634281404714636000,0.24670397343759459000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49423361128815069000,0.24498470764654273000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49620066475249780000,0.24655399793744809000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49387384307977356000,0.24464184892880020000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49605535801384470000,0.24640056236883087000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49348689967498283000,0.24427329605306816000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49590732810103177000,0.24624409855048238000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49307048594925518000,0.24387691967435104000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49575710397844508000,0.24608513425195877000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.49213899953807400000,0.24299123391234820000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49545273226690212000,0.24576236617053149000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49161821452783672000,0.24249667898988084000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49530022229831927000,0.24560020597413779000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49105649753102021000,0.24196378290916412000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49514881749126705000,0.24543885721643377000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.49045032150762602000,0.24138935122355312000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49499969765934143000,0.24527950873397761000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.48979586067902414000,0.24076994341392582000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49485420459966423000,0.24512351449881789000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.48908897769926885000,0.24010186923128854000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49471384724167378000,0.24497239926387621000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.48832521584304767000,0.23938119150603671000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49458030140014242000,0.24482785887216443000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.48749979858692438000,0.23860373789470918000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49445540174666747000,0.24469175282809302000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.48660763935680873000,0.23776512434738681000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49434112321927415000,0.24456608633042526000,-0.49560532085582476000,0.24592430495269965000,
0.25000000000000000000,-0.48564336456875301000,0.23686079331776308000,-0.49262209688544734000,0.24345040422558195000,0.25000000000000000000,-0.49423954873787906000,0.24445297859039730000,-0.49560532085582476000,0.24592430495269965000,
/* 640Hz band*/
0.25000000000000000000,-0.49057459100205864000,0.24324938993393558000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49323484904273918000,0.24480945525326100000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.49009111709896858000,0.24280655181949348000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49300557565881631000,0.24455439832501755000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48957323422449417000,0.24233245142254528000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49276855975608069000,0.24429049544535472000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48901822206520140000,0.24182466648645246000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49252403907087761000,0.24401796085002289000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48842312091429757000,0.24128057129756314000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49227234639332412000,0.24373710616156186000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48778470925957368000,0.24069731966578278000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49201392392816795000,0.24344835518450006000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48709947944343479000,0.24007182691789702000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49174933919612929000,0.24315226030007123000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48636361135411654000,0.23940075104849631000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49147930250936411000,0.24284952049738273000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48557294415976904000,0.23868047325355657000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49120468600432349000,0.24254100103597209000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48472294618150102000,0.23790707819235893000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49092654413357684000,0.24222775465786614000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.48282478514686811000,0.23618367633710241000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.49036494484965876000,0.24159236576564069000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.48176541320694388000,0.23522418690821109000,-0.48380868313500847000,0.23707633450566851000,0.25000000000000000000,-0.49008470692101114000,0.24127347320714435000,-0.49064613538815716000,0.24191104413418699000,
0.25000000000000000000,-0.48062422605967525000,0.23419258558183878000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48980742724965409000,0.24095640065346458000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.47939434900107658000,0.23308322034393725000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48953540240000670000,0.24064348396484103000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.47806834662862263000,0.23189006822017649000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48927123526039407000,0.24033737773713873000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.47663820233085807000,0.23060674684983223000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48901784344007837000,0.24004106557953067000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.47509530815492873000,0.22922654118669425000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48877845707255152000,0.23975786000603724000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.47343046961501678000,0.22774245002053389000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48855660153032354000,0.23949138740393081000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.47163393087465622000,0.22614725754767268000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48835605970251617000,0.23924555263718511000,-0.49064613538823276000,0.24191104413427342000,
0.25000000000000000000,-0.46969542629471139000,0.22443363527336632000,-0.48380868313493247000,0.23707633450558302000,0.25000000000000000000,-0.48818080794629076000,0.23902447723387107000,-0.49064613538823276000,0.24191104413427342000,
/* 1280Hz band*/
0.25000000000000000000,-0.47615452100401057000,0.23668371992206524000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48348823005576291000,0.23970934249426964000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.47514458596980702000,0.23582394568438175000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48309280763347884000,0.23920889996374586000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.47406445355750437000,0.23490534909834968000,-0.46215162266441856000,0.22485086703342519000,0.25000000000000000000,-0.48268492243018335000,0.23869162905622884000,-0.47908491422206151000,0.23405266990050008000,
0.25000000000000000000,-0.47290878159803351000,0.23392363455984355000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48226512966850177000,0.23815800633306627000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.47167178333482473000,0.23287418445219799000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48183416530445156000,0.23760869980473712000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.47034718906656359000,0.23175203871793515000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48139297219907795000,0.23704459685111939000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.46892820498497617000,0.23055187468676164000,-0.46215162266441856000,0.22485086703342519000,0.25000000000000000000,-0.48094272895362655000,0.23646683499829260000,-0.47908491422206151000,0.23405266990050008000,
0.25000000000000000000,-0.46740746926095444000,0.22926798777302548000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48048488143913859000,0.23587683561351638000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.46577700556059226000,0.22789427388164993000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.48002117694157009000,0.23527634047650675000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.46402817435695631000,0.22642421465068596000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47955370068042164000,0.23466745103207762000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.46013723318656624000,0.22316685919706175000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47861769497205331000,0.23343494389630473000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.45797407436616028000,0.22136439531035765000,-0.46215162266441856000,0.22485086703342519000,0.25000000000000000000,-0.47815537546434173000,0.23281770734741283000,-0.47908491422206151000,0.23405266990050008000,
0.25000000000000000000,-0.45565035349452637000,0.21943527252289619000,-0.46215162266441856000,0.22485086703342519000,0.25000000000000000000,-0.47770178053078272000,0.23220492387773201000,-0.47908491422206151000,0.23405266990050008000,
0.25000000000000000000,-0.45315337591234978000,0.21737091430602812000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47726125959847787000,0.23160112397823135000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.45046951445076566000,0.21516242531834184000,-0.46215162266441856000,0.22485086703342519000,0.25000000000000000000,-0.47683871028797215000,0.23101143460100035000,-0.47908491422206151000,0.23405266990050008000,
0.25000000000000000000,-0.44758419462755639000,0.21280067401310099000,-0.46215162266441856000,0.22485086703342519000,0.25000000000000000000,-0.47643958816599286000,0.23044159565397287000,-0.47908491422206151000,0.23405266990050008000,
0.25000000000000000000,-0.44448190269570281000,0.21027641020014132000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47606989597443361000,0.22989795666948870000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.44114622532351977000,0.20758042548276862000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47573614402941955000,0.22938744517108012000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.43755993120688441000,0.20470376453855646000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47544527202009534000,0.22891749661288832000,-0.47908491422203842000,0.23405266990046489000,
0.25000000000000000000,-0.43370510582251054000,0.20163799406588345000,-0.46215162266444121000,0.22485086703345900000,0.25000000000000000000,-0.47520452158804488000,0.22849593465302590000,-0.47908491422203842000,0.23405266990046489000,
/* 2500Hz band*/
0.25000000000000000000,-0.43588130252327251000,0.22467222504711123000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45707603065288510000,0.23017213637114198000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.43381423067124236000,0.22308958503053561000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45654195764505812000,0.22922587278901677000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.43161070950157265000,0.22140567102271261000,-0.40777333988537312000,0.20344500772249460000,0.25000000000000000000,-0.45599418091643146000,0.22824964010616516000,-0.45135311358431573000,0.21958388771324716000,
0.25000000000000000000,-0.42926123150246909000,0.21961404078458505000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45543400266533401000,0.22724454332490904000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.42675560256870138000,0.21770790713726351000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45486304187830107000,0.22621205369665742000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.42408289557647283000,0.21568013968696614000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45428327742617369000,0.22515405840826053000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.42123140243561075000,0.21352327291398687000,-0.40777333988537312000,0.20344500772249460000,0.25000000000000000000,-0.45369709520732177000,0.22407291489149539000,-0.45135311358431573000,0.21958388771324716000,
0.25000000000000000000,-0.41818858517605928000,0.21122952251011440000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45310733926916180000,0.22297150977150834000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.41494102689747531000,0.20879081230000851000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45251736662344344000,0.22185332227829621000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.41147438378294510000,0.20619881462581385000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45193110515627311000,0.22072249165925137000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.40382156707950434000,0.20052075436912625000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45078864178068084000,0.21844318297070839000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.39960169348551244000,0.19741740696137830000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.45024368893406730000,0.21730692421211850000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.39509528486791023000,0.19412644508436239000,-0.40777333988537312000,0.20344500772249460000,0.25000000000000000000,-0.44972505585326461000,0.21618259987951463000,-0.45135311358431573000,0.21958388771324716000,
0.25000000000000000000,-0.39028284505074567000,0.19063965260323412000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.44924038622891371000,0.21507869842111466000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.38514384330364737000,0.18694934210146391000,-0.40777333988537312000,0.20344500772249460000,0.25000000000000000000,-0.44879818977391184000,0.21400475065330507000,-0.45135311358431573000,0.21958388771324716000,
0.25000000000000000000,-0.37965677893281224000,0.18304863495550630000,-0.40777333988537312000,0.20344500772249460000,0.25000000000000000000,-0.44840783788925864000,0.21297134680221608000,-0.45135311358431573000,0.21958388771324716000,
0.25000000000000000000,-0.37379929584964244000,0.17893180507799281000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.44807951994484696000,0.21199011605680312000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.36754836241367683000,0.17459469285446774000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.44782414569283502000,0.21107365344405751000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.36088053381687923000,0.17003519231483616000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.44765317727719123000,0.21023537610481960000,-0.45135311358430763000,0.21958388771323784000,
0.25000000000000000000,-0.35377231479362548000,0.16525380824885216000,-0.40777333988538078000,0.20344500772250312000,0.25000000000000000000,-0.44757837366000164000,0.20948928946433490000,-0.45135311358430763000,0.21958388771323784000,
/* 5000Hz band*/
0.25000000000000000000,-0.31015430597384641000,0.20209728282304473000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37493475415268940000,0.21095043821912246000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.30612150084099243000,0.19932962933305734000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37484711337660892000,0.20915159679399692000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.30185467398627752000,0.19641325741343263000,-0.25764656038352529000,0.16710039299780999000,0.25000000000000000000,-0.37477099669078628000,0.20730287318247631000,-0.37505917325938887000,0.19125156370884283000,
0.25000000000000000000,-0.29734106552006501000,0.19334233297217937000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37470942634554538000,0.20540722682088064000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.29256735527167405000,0.19011121752381227000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37466591313109177000,0.20346835707491029000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.28751965922941947000,0.18671457218032345000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37464451975544455000,0.20149079200775344000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.28218353009659236000,0.18314748246649964000,-0.25764656038352529000,0.16710039299780999000,0.25000000000000000000,-0.37464992949698483000,0.19947998389594482000,-0.37505917325938887000,0.19125156370884283000,
0.25000000000000000000,-0.27654396313389551000,0.17940560723812760000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37468751952535756000,0.19744241112938227000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.27058540889009153000,0.17548535534298840000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37476343774088822000,0.19538568568344863000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.26429179503659345000,0.17138409398763726000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37488468121569485000,0.19331866469276979000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,-0.25063270534173254000,0.16263430918929742000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37529583469779249000,0.18919606788834417000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.24323286469128963000,0.15798771474694370000,-0.25764656038352529000,0.16710039299780999000,0.25000000000000000000,-0.37560464305775854000,0.18716543551686976000,-0.37505917325938887000,0.19125156370884283000,
0.25000000000000000000,-0.23542941059728728000,0.15316467261277467000,-0.25764656038352529000,0.16710039299780999000,0.25000000000000000000,-0.37599667091987254000,0.18517458579728813000,-0.37505917325938887000,0.19125156370884283000,
0.25000000000000000000,-0.22720459641456731000,0.14817186007963362000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37648409169879815000,0.18324015960968937000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.21854075488875530000,0.14301903862234763000,-0.25764656038352529000,0.16710039299780999000,0.25000000000000000000,-0.37708013760003456000,0.18138053793087397000,-0.37505917325938887000,0.19125156370884283000,
0.25000000000000000000,-0.20942056765812533000,0.13771956289999807000,-0.25764656038352529000,0.16710039299780999000,0.25000000000000000000,-0.37779899072422274000,0.17961579788099935000,-0.37505917325938887000,0.19125156370884283000,
0.25000000000000000000,-0.19982742595726566000,0.13229091417866468000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37865558479182410000,0.17796758131653637000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.18974590413999143000,0.12675523256010096000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.37966529273976179000,0.17645884634377612000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.17916236651723055000,0.12113980810329086000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.38084347607825547000,0.17511346957910215000,-0.37505917325938820000,0.19125156370884239000,
0.25000000000000000000,-0.16806572189047436000,0.11547747375483490000,-0.25764656038352551000,0.16710039299781027000,0.25000000000000000000,-0.38220487757355837000,0.17395566872825047000,-0.37505917325938820000,0.19125156370884239000,
/* 10000Hz band*/
0.25000000000000000000,0.02614110711196013900,0.16604259736659738000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.14357510071299481000,0.17015827184196425000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.03113405838272433100,0.16220442287205139000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.14707463223725684000,0.16671710087816244000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.03634194793185548100,0.15827277781499355000,0.08663208407806702300,0.12509709794969853000,0.25000000000000000000,-0.15072550747330482000,0.16321449004614924000,-0.18626770783678803000,0.13477345434999966000,
0.25000000000000000000,0.04177170245457004900,0.15425717207058950000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.15453407402928260000,0.15966150024600820000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.04743050076344218500,0.15016920853636609000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.15850721539533541000,0.15607117453523470000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.05332580590126145100,0.14602282358560259000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.16265241398123986000,0.15245873260090370000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.05946538884420817700,0.14183453736232554000,0.08663208407806702300,0.12509709794969853000,0.25000000000000000000,-0.16697780473068657000,0.14884176638809105000,-0.18626770783678803000,0.13477345434999966000,
0.25000000000000000000,0.06585733492059789300,0.13762370746616456000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.17149220965107598000,0.14524042907730014000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.07251002048645055500,0.13341277577868890000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.17620513994618403000,0.14167760572494509000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.07943204313843399400,0.12922749293216620000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.18112674813261984000,0.13817904869213704000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.25000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,0.00000000000000000000,
0.25000000000000000000,0.09411867680006941200,0.12105442181145012000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.19163899454452424000,0.13149244957179507000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.10189985323598659000,0.11713587347073841000,0.08663208407806699500,0.12509709794969850000,0.25000000000000000000,-0.19725153758904915000,0.12837044779626505000,-0.18626770783678787000,0.13477345434999954000,
0.25000000000000000000,0.10998263872511688000,0.11338125628478028000,0.08663208407806702300,0.12509709794969853000,0.25000000000000000000,-0.20311571400110498000,0.12544432638091657000,-0.18626770783678803000,0.13477345434999966000,
0.25000000000000000000,0.11837237334277345000,0.10983335428455795000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.20924066114362774000,0.12275287213870678000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.12707185228739540000,0.10653722511459147000,0.08663208407806702300,0.12509709794969853000,0.25000000000000000000,-0.21563340040698176000,0.12033594432850993000,-0.18626770783678803000,0.13477345434999966000,
0.25000000000000000000,0.13608030488695277000,0.10353914529582234000,0.08663208407806702300,0.12509709794969853000,0.25000000000000000000,-0.22229779131928118000,0.11823331901663250000,-0.18626770783678803000,0.13477345434999966000,
0.25000000000000000000,0.14539227090800683000,0.10088517976269978000,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.22923337479878592000,0.11648321059743960000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.15499648043319386000,0.09861939569448249800,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.23643421212720078000,0.11512051769008663000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.16487488947800299000,0.09678180931562520300,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.24388787240450274000,0.11417490782765949000,-0.18626770783678781000,0.13477345434999960000,
0.25000000000000000000,0.17500205147164372000,0.09540623310767780400,0.08663208407806702300,0.12509709794969864000,0.25000000000000000000,-0.25157474946970060000,0.11366892543420801000,-0.18626770783678781000,0.13477345434999960000,


};
/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

/**
 * @brief Initialize equalizer.
 * 
 */
void equalizer_init(void)
{
        arm_float_to_q31(floatCoeffTable, coeffTable, NUMBER_OF_BANDS * COEF_PER_FILTER * GAIN_LEVELS)
    /* Initialize the state and coefficient buffers for all Biquad sections all gains set to 0 on setup*/

        arm_biquad_cas_df1_32x64_init_q31(&S1, NUMBER_OF_STAGES,
            (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*0 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
            &biquadStateBandQ63[0][0], 2);

        arm_biquad_cas_df1_32x64_init_q31(&S2, NUMBER_OF_STAGES,
            (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*1 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
            &biquadStateBandQ63[0][1], 2);

         arm_biquad_cascade_df1_init_q31(&S3, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*2 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
          &biquadStateBandQ31[0][0], 2);

        arm_biquad_cascade_df1_init_q31(&S4, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*3 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
          &biquadStateBandQ31[0][1], 2);

         arm_biquad_cascade_df1_init_q31(&S5, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*4 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
          &biquadStateBandQ31[0][2], 2);

        arm_biquad_cascade_df1_init_q31(&S6, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*5 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
          &biquadStateBandQ31[0][3], 02);

         arm_biquad_cascade_df1_init_q31(&S7, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*6 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
          &biquadStateBandQ31[0][4], 2);

        arm_biquad_cascade_df1_init_q31(&S8, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*7 + COEF_PER_FILTER*(DEFAULT_GAIN + MAX_GAIN)],
          &biquadStateBandQ31[0][5], 2);

  
}

/**
 * @brief Sets  equalizer filter gains.
 * @param gain  number in dB with the desired gain of the filter
 * @param band selected band in which to change gain (between 1 and NUMBER_OF_BANDS)
 */
void equalizer_set_band_gain (int32_t band, int32_t gain)
{
    if(band < 3 )
    {
         arm_biquad_cas_df1_32x64_init_q31(&S1, NUMBER_OF_STAGES,
            (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*0 + COEF_PER_FILTER*(gain + MAX_GAIN)],
            &biquadStateBandQ63[0][band - 1], 2);
    }
    else
    {
         arm_biquad_cascade_df1_init_q31(&S7, NUMBER_OF_STAGES,
          (q31_t *) &coeffTable[COEF_PER_FILTER*GAIN_LEVELS*6 + COEF_PER_FILTER*(gain + MAX_GAIN)],
          &biquadStateBandQ31[0][band - 3], 2);
    }
}

/**
 * @brief Applies the filter to the data in inputF32 and stores the result in outputF32
 * @param inputF32  pointer to an array of size FRAME_SIZE with input data
 * @param outputF32 pointer to an array of size FRAME_SIZE //!(will be overwritten)
 */
void equalizer_equalize(float32_t* inputF32, float32_t * outputF32)
{
    
    /* ----------------------------------------------------------------------
    ** Q31 input and output buffers
    ** ------------------------------------------------------------------- */

    q31_t inputQ31[BLOCKSIZE];
    q31_t outputQ31[BLOCKSIZE];

    for(i=0; i < NUMBLOCKS; i++)
  {

    /* ----------------------------------------------------------------------
    ** Convert block of input data from float to Q31
    ** ------------------------------------------------------------------- */

    arm_float_to_q31(inputF32 + (i*BLOCKSIZE), inputQ31, BLOCKSIZE);

    /* ----------------------------------------------------------------------
    ** Scale down by 1/8.  This provides additional headroom so that the
    ** graphic EQ can apply gain.
    ** ------------------------------------------------------------------- */

    arm_scale_q31(inputQ31, 0x7FFFFFFF, -3, inputQ31, BLOCKSIZE);

    /* ----------------------------------------------------------------------
    ** Call the Q31 Biquad Cascade DF1 32x64 process function for band1, band2
    ** ------------------------------------------------------------------- */

    arm_biquad_cas_df1_32x64_q31(&S1, inputQ31, outputQ31, BLOCKSIZE);
    arm_biquad_cas_df1_32x64_q31(&S2, outputQ31, outputQ31, BLOCKSIZE);

    /* ----------------------------------------------------------------------
    ** Call the Q31 Biquad Cascade DF1 process function for band3, band4, band5, band6, band7, band8
    ** ------------------------------------------------------------------- */

    arm_biquad_cascade_df1_fast_q31(&S3, outputQ31, outputQ31, BLOCKSIZE);
    arm_biquad_cascade_df1_fast_q31(&S4, outputQ31, outputQ31, BLOCKSIZE);
    arm_biquad_cascade_df1_fast_q31(&S5, outputQ31, outputQ31, BLOCKSIZE);
    arm_biquad_cascade_df1_fast_q31(&S6, outputQ31, outputQ31, BLOCKSIZE);
    arm_biquad_cascade_df1_fast_q31(&S7, outputQ31, outputQ31, BLOCKSIZE);
    arm_biquad_cascade_df1_fast_q31(&S8, outputQ31, outputQ31, BLOCKSIZE);

    /* ----------------------------------------------------------------------
    ** Convert Q31 result back to float
    ** ------------------------------------------------------------------- */

    arm_q31_to_float(outputQ31, outputF32 + (i * BLOCKSIZE), BLOCKSIZE);

    /* ----------------------------------------------------------------------
    ** Scale back up
    ** ------------------------------------------------------------------- */

    arm_scale_f32(outputF32 + (i * BLOCKSIZE), 8.0f, outputF32 + (i * BLOCKSIZE), BLOCKSIZE);
  };
}